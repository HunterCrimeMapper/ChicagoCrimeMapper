<!doctype html>

<head>
<!-- google font -->
<link href="https://fonts.googleapis.com/css?family=Palanquin+Dark" rel="stylesheet">

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Include Required Prerequisites -->
<script type="text/javascript" src="//cdn.jsdelivr.net/jquery/1/jquery.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap/3/css/bootstrap.css" />

<script type="text/javascript" src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>

<!-- Bootstrap Date-Picker Plugin -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css"/>


 <!-- Include Date Range Picker -->
<script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />

<script>
$(document).ready(function runit(){
     $('.dropdown-menu li a').click(function run_it(){
       var selText = $(this).text();
       console.log(selText);
       window.crime = selText;
       $(this).parents('.dropdown').find('.dropdown-toggle').html(selText);
     });
});
</script>


</head>
<div class="container">
	<center>
		<h1 style="color:white; font-family:'Palanquin Dark', sans-serif; font-weight:bold;">CHICAGO CRIME MAPPER</h1>
		<p style="color:white">An interactive heat map detailing crime statistics in Chicago </p>
	</center>
</div>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
     <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
		<li class="dropdown">
          <a href="#" id="theTitle" class="dropdown-toggle" data-toggle="dropdown" role="menu" aria-haspopup="true" aria-expanded="false" style ="color:#d9d9d9">Select Crime Type<span class="caret"></span></a>
          <ul class="dropdown-menu"  id="diff_crimes" style="height:auto; max-height:200px; overflow-x:hidden;">
            <li><a href="#" class="small" data-value="Arson" tabIndex="0"> Arson</a></li>
			<li><a href="#" class="small" data-value="Assault" tabIndex="1"> Assault</a></li>
			<li><a href="#" class="small" data-value="Battery" tabIndex="2"> Battery</a></li>
			<li><a href="#" class="small" data-value="Burglary" tabIndex="3"> Burglary</a></li>
			<li><a href="#" class="small" data-value="Concealed Carry License Violation" tabIndex="0"> Concealed Carry License Violation</a></li>
			<li><a href="#" class="small" data-value="Criminal Sexual Assault" tabIndex="0"> Criminal Sexual Assault</a></li>
			<li><a href="#" class="small" data-value="Criminal Damage" tabIndex="0"> Criminal Damage</a></li>
			<li><a href="#" class="small" data-value="Criminal Trespass" tabIndex="0"> Criminal Trespass</a></li>
			<li><a href="#" class="small" data-value="Deceptive Practice" tabIndex="0"> Deceptive Practice</a></li>
			<li><a href="#" class="small" data-value="Gambling" tabIndex="-1"> Gambling</a></li>
			<li><a href="#" class="small" data-value="Homicide" tabIndex="-1"> Homicide</a></li>
			<li><a href="#" class="small" data-value="Human Trafficking" tabIndex="-1"> Human Trafficking</a></li>
			<li><a href="#" class="small" data-value="Interference With Public Officer" tabIndex="-1"> Interference With Public Officer</a></li>
			<li><a href="#" class="small" data-value="Intimidation" tabIndex="-1"> Intimidation</a></li>
			<li><a href="#" class="small" data-value="Kidnapping" tabIndex="-1"> Kidnapping</a></li>
			<li><a href="#" class="small" data-value="Liquor Law Violation" tabIndex="-1"> Liquor Law Violation</a></li>
			<li><a href="#" class="small" data-value="Motor Vehicle Theft" tabIndex="-1"> Motor Vehicle Theft</a></li>
			<li><a href="#" class="small" data-value="Narcotics" tabIndex="-1"> Narcotics</a></li>
			<li><a href="#" class="small" data-value="Obscenity" tabIndex="-1"> Obscenity</a></li>
			<li><a href="#" class="small" data-value="Offense Involving Children" tabIndex="-1"> Offense Involving Children</a></li>
			<li><a href="#" class="small" data-value="Other Narcotic Violation" tabIndex="-1"> Other Narcotic Violation</a></li>
			<li><a href="#" class="small" data-value="Other Offense" tabIndex="-1"> Other Offense</a></li>
			<li><a href="#" class="small" data-value="Prostitution" tabIndex="-1"> Prostitution</a></li>
			<li><a href="#" class="small" data-value="Public Indecency" tabIndex="-1"> Public Indecency</a></li>
			<li><a href="#" class="small" data-value="Public Peace Violation" tabIndex="-1"> Public Peace Violation</a></li>
			<li><a href="#" class="small" data-value="Robbery" tabIndex="-1"> Robbery</a></li>
			<li><a href="#" class="small" data-value="Sex Offense" tabIndex="-1"> Sex Offense</a></li>
			<li><a href="#" class="small" data-value="Stalking" tabIndex="-1"> Stalking</a></li>
			<li><a href="#" class="small" data-value="Theft" tabIndex="-1"> Theft</a></li>
			<li><a href="#" class="small" data-value="Weapons Violation" tabIndex="-1"> Weapons Violation</a></li>
          </ul>
        </li>
      </ul>


<div class="container-fluid">
	<div class="row">
 		<form method="post">
      		<div class="form-group"> <!-- Date input -->
         	  	<div class="col-md-3">
        			<label class="label label-success" for="start_date">START DATE</label>
        			<input class="form-control" id="start_date" name="start_date" placeholder="YYYY-MM-DD" type="text">
        		</div>
      		</div>
      		<div class="form-group"> <!-- Date input -->
           		<div class="col-md-3">
        			<label class="label label-danger" for="end_date">END DATE</label>
        			<input class="form-control" id="end_date" name="end_date" placeholder="YYYY-MM-DD" type="text">
        		</div>
      		</div>
      		<div class="form-group"> <!-- Submit button -->
           		<div class="col-md-2">
        			<button class="btn btn-primary " name="submit_dates" id="submit_dates" type="submit" style="margin:19px">Submit</button>
        		</div>
      		</div>
 		</form>
    	</div>
</div>


<script>
	$(document).ready(function(e){
	  var date_input=$('input[name="start_date"]'); //our date input has the name "date"
      var container=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
      var options={
        format: 'yyyy-mm-dd',
        container: container,
        todayHighlight: true,
        autoclose: true,
        startDate: "2001-01-01",
        endDate: "2017-03-30",
      };
      date_input.datepicker(options);

	  var date_input_=$('input[name="end_date"]'); //our date input has the name "date"
      var container_=$('.bootstrap-iso form').length>0 ? $('.bootstrap-iso form').parent() : "body";
      var options_={
        format: 'yyyy-mm-dd',
        container: container_,
        todayHighlight: true,
        autoclose: true,
        startDate: "2001-01-01",
        endDate: "2017-03-30",
      };
      date_input_.datepicker(options_);

	  $("#submit_dates").click(function(e){
            e.preventDefault();
            var from_date = $(start_date).datepicker("getDate");
            var to_date = $(end_date).datepicker("getDate");
            if (window.crime == null){
                window.crime = 'Burglary';
            }
            if (from_date === null || to_date === null || from_date == '' || to_date == ''){
                alert("Please enter a start and end date.");
            }

            var crime_info = {'crime': window.crime, 'start': from_date, 'end': to_date};
					$.ajax({
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(crime_info),
                            dataType: 'json',
                            url: '/crime_data',
                            success: function(e){
                                console.log(e);
                                //window.location = '/mapview';
                                document.getElementById('theMap').contentWindow.location.reload();
                            },
                            error: function(error) {
                            console.log(error);
                            }
                   	});
          });
	});
</script>
<!--
      <form class="navbar-form navbar-left">
        <div class="form-group">
          <input type="text" class="form-control" name="daterange" value="01/01/2001 - 04/19/2017" size="60" style="text-align:center">
		  <script type="text/javascript">
			$(function() {
				$('input[name="daterange"]').daterangepicker(
                {
                    "showDropdowns": true,
                    "timePickerIncrement": 1,
                    //"autoApply": true,
                    "startDate": "01/01/2001",
                    "endDate": "04/01/2017",
                    "minDate": "01/01/2001",
                    "maxDate": "04/01/2017",
                    "opens": "left",
                    "drops": "down",
                    "buttonClasses": "btn btn-lg",
                    "applyClass": "btn-success",
                    "cancelClass": "btn-default"


                },
                function(start, end, label) {
                        console.log("start is: ", start);
                        console.log("end is",  end);
                        window.start = start;
                        window.end = end;
                        if (window.crime == null){
                            window.crime = 'Arson';
                        }
                        var _start = window.start._d
                        var crime_info = {'crime': window.crime, 'start': window.start._d, 'end': window.end._d};
                        $(document).ready(function(){
                        $.ajax({
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(crime_info),
                            dataType: 'json',
                            url: '/crime_data',
                            success: function(e){
                                console.log(e);
                                document.getElementById('theMap').contentWindow.location.reload();
                                //:window.location = '/crime_data';
                            },
                            error: function(error) {
                            console.log(error);
                        }
                        });
                        });
                        console.log(crime_info);
                });
            });


			</script>
        </div>
      </form>

-->

      <ul class="nav navbar-nav navbar-right">
	<li><a href="https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2/data" target="_blank" style ="color:#d9d9d9">Data Source</a></li>
	<li><a href="{{ url_for('group_info')  }}" target="_blank" style ="color:#d9d9d9">About the Team</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
<body style="background-color:#333333;">
  	<div class="map">
		<center>
			<p><iframe id="theMap" style="border: 1px solid #ccc" width="70%" height="700" src="{{ url_for('get_map') }}"></iframe></p>
		</center>
	</div>
</body>
