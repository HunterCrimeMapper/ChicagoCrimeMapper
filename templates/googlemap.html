<!DOCTYPE <!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
	<style>
	html, body,#map{
		height: 100%;
		width: 100%;
		margin: 0; padding: 0; overflow: hidden;
	}
	.nicebox {
          position: absolute;
          text-align: center;
          font-family: "Roboto", "Arial", sans-serif;
          font-size: 13px;
          z-index: 5;
          box-shadow: 0 4px 6px -4px #333;
          padding: 5px 10px;
          background: rgb(255,255,255);
          background: linear-gradient(to bottom,rgba(255,255,255,1) 0%,rgba(245,245,245,1) 100%);
          border: rgb(229, 229, 229) 1px solid;
        }
	#controls {
          top: 10px;
          left: 110px;
          width: 360px;
          height: 45px;
        }
        #data-box {
      top: 10px;
      left: 500px;
      height: 45px;
      line-height: 45px;
      display: none;
    }
    #census-variable {
      width: 360px;
      height: 20px;
    }
    .color-key {
          background: linear-gradient(to right,
            hsl(44, 99%, 73%) 0%,
            hsl(34, 99%, 65%) 20%,
            hsl(25, 98%, 61%) 40%,
            hsl(10, 97%, 58%) 60%,
            hsl(359, 79%, 50%) 80%,
            hsl(342, 100%, 25%) 100%);
          flex: 1;
          -webkit-box-flex: 1;
          margin: 0 5px;
          text-align: left;
          font-size: 1.0em;
          line-height: 1.0em;
        }
    #legend { display: flex; display: -webkit-box; padding-top: 7px }
    #data-score { font-size: 2.0em; font-weight: bold }
    #data-id { font-size: 2.0em; font-weight: normal; padding-right: 10px; }
    #data-id:after { content: ':' }
    #data-caret { margin-left: -5px; display: none; font-size: 14px; width: 14px}
	</style>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>


</head>
<body>
	<div id="controls" class="nicebox">
      <div id="legend">
        <div id="census-min">0</div>
        <div class="color-key"><span id="data-caret">&#x25c6;</span></div>
        <div id="census-max">6</div>
      </div>
    </div>
    <div id="data-box" class="nicebox">
      <label id="data-id" for="data-score"></label>
      <span id="data-score"></span>
    </div>
	<div id="map"></div>
	<script>

		var map;
		var zoneslayer;

		var data =(function jsontovar(){
			var file = null;
			$.ajax({
			    type: 'GET',
			    url: '../static/choro_score6.json',

			    async: false,
			    dataType: 'json',
			    success: function(data) {
			    	file = data;
			    }
			});
			return file;
		})();


		function initMap(){
			var locat = {lat:41.889179863, lng:-87.633110109};
			map = new google.maps.Map(document.getElementById('map'),{
				zoom:10,
				center:locat
			});

            map.setOptions({minZoom: 10})
			zoneslayer = new google.maps.Data();
			zoneslayer.loadGeoJson('https://raw.githubusercontent.com/HunterCrimeMapper/ChicagoCrimeMapper/master/geoJSONs/google_map_geoJSON.json');


	        zoneslayer.setStyle(styleFeature);
	        zoneslayer.addListener('mouseover',mouseInToRegion);
	        zoneslayer.addListener('mouseout',mouseOutOfRegion);

	        zoneslayer.setMap(map);
		}
		function mouseInToRegion(e){

			zoneslayer.revertStyle();
	        zoneslayer.overrideStyle(e.feature, {strokeWeight:8});

	        var percent;

	        var zoneid = e.feature.getId('id');
	        zoneid= zoneid-1;
	        var score = data[zoneid].value;

			percent= (score*100)/6;

	        document.getElementById('data-id').textContent =
      		e.feature.getId('id');
      		document.getElementById('data-score').textContent =
      score.toLocaleString();
  			document.getElementById('data-box').style.display = 'block';
  			document.getElementById('data-caret').style.display = 'block';
  			document.getElementById('data-caret').style.paddingLeft =percent+'%' ;

		}
		function mouseOutOfRegion(e){
			zoneslayer.revertStyle();

		}
		function styleFeature(feature){
	        	var color = 'gray';
	        	var zoneid = feature.getId('id');
	        	for(var i =0; i< data.length; i++){
					if(data[i].ID == zoneid){
						if (data[i].value >4.9){
						    color ='#800026';
						}
						else if (data[i].value >3.9){
						    color ='#e31a1c';
						}
						else if (data[i].value > 2.9) {
							color ='#fc4e2a';
						}
						else if (data[i].value > 1.9) {
						    color ='#fd8d3c';
						}
						else if(data[i].value > 0.9) {
							color ='#feb24c';
						}
						else {
						    color ='#fed976';
						}
					}
				}

	        	return ({
            		fillColor: color,
			fillOpacity: 0.75,
            		strokeColor: 'white',
            		strokeWeight: 0.4
          		});
	        }


	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAykistmbpdBlYdIgXL1gM3fU_jv4DyayE&callback=initMap"></script>
</body>
</html>
